<!-- File: templates/blog/includes/dashboard_modals.html -->

<!-- ============================================= -->
<!-- === THE NEW, IMPROVED EDIT PROFILE MODAL === -->
<!-- ============================================= -->
<div class="modal fade" id="profileEditModal" tabindex="-1" aria-labelledby="profileEditModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered"> <!-- Centered and larger modal -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="profileEditModalLabel">Edit Your Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row g-4 align-items-center">

                <!-- Left Column: Profile Picture -->
                <div class="col-md-4 text-center">
                    <img src="{{ user.profile.image.url }}" class="profile-pic-preview mb-3" alt="Profile Picture">
                    <label for="id_image" class="btn btn-outline-primary btn-sm w-100">
                        <i class="bi bi-upload"></i> Upload New Picture
                    </label>
                    <!-- This hides the default file input but keeps it functional -->
                    <div class="d-none">{{ p_form.image }}</div>
                </div>

                <!-- Right Column: Form Fields -->
                <div class="col-md-8">
                    <!-- Username Field -->
                    <div class="mb-3">
                        <label for="{{ u_form.username.id_for_label }}" class="form-label fw-bold">Username</label>
                        {{ u_form.username }}
                        {% if u_form.username.errors %}
                            <div class="invalid-feedback d-block">{{ u_form.username.errors.as_text }}</div>
                        {% endif %}
                    </div>

                    <!-- Email Field -->
                    <div class="mb-3">
                        <label for="{{ u_form.email.id_for_label }}" class="form-label fw-bold">Email</label>
                        {{ u_form.email }}
                         {% if u_form.email.errors %}
                            <div class="invalid-feedback d-block">{{ u_form.email.errors.as_text }}</div>
                        {% endif %}
                    </div>

                    <!-- Bio Field -->
                    <div class="mb-3">
                        <label for="{{ p_form.bio.id_for_label }}" class="form-label fw-bold">Bio</label>
                        {{ p_form.bio }}
                        <small class="form-text text-muted">A short description of yourself for your public profile.</small>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer mt-4">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="submit">Save Changes</button>
            </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- ============================================= -->
<!-- === NOTIFICATIONS OFFCANVAS PANEL === -->
<!-- ============================================= -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="notificationsOffcanvas">
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title"><i class="bi bi-bell-fill"></i> Notifications</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="list-group list-group-flush">
        {% for notification in notifications %}
        <a href="#" class="list-group-item list-group-item-action">
            <p class="mb-1">{{ notification.message }}</p>
            <small class="text-muted">{{ notification.created_at|timesince }} ago</small>
        </a>
        {% empty %}
        <div class="list-group-item text-muted">You have no new notifications.</div>
        {% endfor %}
    </div>
  </div>
</div>