{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- HERO/FEATURED SECTION -->
    {% if featured_post %}
    <div class="p-4 p-md-5 mb-4 text-white rounded bg-dark hero-section" style="background-image: url('{{ featured_post.photo.url }}');">
        <div class="col-md-6 px-0">
            <a href="#" class="badge bg-primary text-decoration-none mb-2">{{ featured_post.genre.name|default:"General" }}</a>
            <h1 class="display-4 fst-italic">{{ featured_post.title }}</h1>
            <p class="lead my-3">{{ featured_post.content|safe|truncatewords_html:20 }}</p>
            <p class="lead mb-0"><a href="{% url 'post_detail' featured_post.pk %}" class="text-white fw-bold">Continue reading...</a></p>
        </div>
    </div>
    {% endif %}

    <div class="row g-5">
        <!-- Main Content (Left Column) -->
        <div class="col-md-8">
            <h3 class="pb-4 mb-4 fst-italic border-bottom">
                Latest Posts
            </h3>

            {% for post in posts %}
            <article class="blog-post card mb-4 shadow-sm">
                {% if post.photo %}
                    <a href="{% url 'post_detail' post.pk %}">
                        <img src="{{ post.photo.url }}" class="card-img-top" alt="{{ post.title }}">
                    </a>
                {% endif %}
                <div class="card-body">
                    <a href="#" class="badge bg-success text-decoration-none mb-2">{{ post.genre.name|default:"General" }}</a>
                    <h2 class="blog-post-title"><a href="{% url 'post_detail' post.pk %}" class="text-dark text-decoration-none">{{ post.title }}</a></h2>
                    <p class="blog-post-meta">{{ post.created_at|date:"F d, Y" }} by <a href="{% url 'profile_page' post.author.username %}">{{ post.author.username }}</a></p>
                    <p>{{ post.content|safe|truncatewords_html:30 }}</p>
                    <a href="{% url 'post_detail' post.pk %}" class="btn btn-outline-primary">Read More</a>
                </div>
            </article>
            {% empty %}
            <div class="alert alert-info">No posts found.</div>
            {% endfor %}

            <!-- Pagination -->
            {% if is_paginated %}
                {% include 'blog/includes/pagination.html' %}
            {% endif %}

        </div>

        <!-- Sidebar (Right Column) -->
        <div class="col-md-4">
            <div class="position-sticky" style="top: 5rem;">
                <div class="p-4 mb-3 bg-light rounded">
                    <h4 class="fst-italic">About</h4>
                    <p class="mb-0">A community blog with AI-powered moderation to maintain a positive and engaging environment for everyone.</p>
                </div>

                <!-- Tabbed Widget for Popular/Latest -->
                <div class="card shadow-sm">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="popular-tab" data-bs-toggle="tab" data-bs-target="#popular" type="button" role="tab">Popular</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="latest-tab" data-bs-toggle="tab" data-bs-target="#latest" type="button" role="tab">Latest</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab">Comments</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                            <!-- Popular Posts Pane -->
                            <div class="tab-pane fade show active" id="popular" role="tabpanel">
                                <ul class="list-unstyled">
                                    {% for post in popular_posts %}
                                    <li><a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="{% url 'post_detail' post.pk %}">
                                        {% if post.photo %}
                                            <img src="{{ post.photo.url }}" width="96" height="96" class="rounded object-fit-cover">
                                        {% endif %}
                                        <div class="col-lg-8">
                                            <h6 class="mb-0">{{ post.title }}</h6>
                                            <small class="text-body-secondary">{{ post.created_at|date:"M d, Y" }}</small>
                                        </div>
                                    </a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <!-- Latest Posts Pane -->
                            <div class="tab-pane fade" id="latest" role="tabpanel">
                                <ul class="list-unstyled">
                                    {% for post in latest_posts %}
                                    <li><a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="{% url 'post_detail' post.pk %}">
                                        {% if post.photo %}
                                            <img src="{{ post.photo.url }}" width="96" height="96" class="rounded object-fit-cover">
                                        {% endif %}
                                        <div class="col-lg-8">
                                            <h6 class="mb-0">{{ post.title }}</h6>
                                            <small class="text-body-secondary">{{ post.created_at|date:"M d, Y" }}</small>
                                        </div>
                                    </a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <!-- Recent Comments Pane -->
                            <div class="tab-pane fade" id="comments" role="tabpanel">
                                <ul class="list-unstyled">
                                    {% for comment in recent_comments %}
                                    <li><a class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center py-3 link-body-emphasis text-decoration-none border-top" href="{% url 'post_detail' comment.post.pk %}#comment-{{ comment.pk }}">
                                        <div class="col-lg-8">
                                            <h6 class="mb-0"><strong>{{ comment.author.username }}</strong> on {{ comment.post.title }}</h6>
                                            <p class="text-body-secondary mb-0">"{{ comment.text|truncatewords:10 }}"</p>
                                        </div>
                                    </a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
